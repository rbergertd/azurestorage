### This code snippet is used to connect to an Azure Storage Account and tier all the blobs to Azure Archive Storage Tier.
### This was converted to use Az cmdlets rather than AzureRm ones on 6/11/2019 by Ryan Berger @ TechData
### You need PowerShell module Az to run the below commands
Install-Module Az -AllowClobber

### Import Azure PowerShell module
    Import-Module Az

### Login to your Azure Account
    Login-AzAccount

### Storage Account information

    ### In case you have several subscriptions select the proper one
    Select-AzSubscription (Get-AzSubscription | Out-GridView -Title "Select your Azure Subscription" -PassThru)

    ### Select the Azure Resource Group and Storage Account
    $ResourceGroupName = (Get-AzResourceGroup | Out-GridView -Title "Select your Resource Group" -PassThru).ResourceGroupName
    $StorageAccount = Get-AzStorageAccount -ResourceGroupName $ResourceGroupName | Out-GridView -Title "Select your Storage Account" -PassThru 
    $StorageAccountKey = (Get-AzStorageAccountKey -ResourceGroupName $ResourceGroupName -Name $StorageAccount.StorageAccountName)[0].Value
    
    ### Create a storage context
    $context = New-AzStorageContext -StorageAccountName $StorageAccount.StorageAccountName -StorageAccountKey $StorageAccountKey
    $containername = (Get-AzStorageContainer -Context $context | Out-GridView -Title "Select your Storage Container" -PassThru).name
    $blobs = Get-AzStorageBlob -Container $containerName -Context $context

### Use the .Net client library API to change the access tier
    Foreach ($blob in $blobs) {
        $blob.ICloudBlob.SetStandardBlobTier("Archive")
    }
# SIG # Begin signature block
# MIIT+wYJKoZIhvcNAQcCoIIT7DCCE+gCAQExCzAJBgUrDgMCGgUAMGkGCisGAQQB
# gjcCAQSgWzBZMDQGCisGAQQBgjcCAR4wJgIDAQAABBAfzDtgWUsITrck0sYpfvNR
# AgEAAgEAAgEAAgEAAgEAMCEwCQYFKw4DAhoFAAQU9dp4j+tOphpLauvrgc97Ia+j
# UPCggg72MIIEmTCCA4GgAwIBAgIPFojwOSVeY45pFDkH5jMLMA0GCSqGSIb3DQEB
# BQUAMIGVMQswCQYDVQQGEwJVUzELMAkGA1UECBMCVVQxFzAVBgNVBAcTDlNhbHQg
# TGFrZSBDaXR5MR4wHAYDVQQKExVUaGUgVVNFUlRSVVNUIE5ldHdvcmsxITAfBgNV
# BAsTGGh0dHA6Ly93d3cudXNlcnRydXN0LmNvbTEdMBsGA1UEAxMUVVROLVVTRVJG
# aXJzdC1PYmplY3QwHhcNMTUxMjMxMDAwMDAwWhcNMTkwNzA5MTg0MDM2WjCBhDEL
# MAkGA1UEBhMCR0IxGzAZBgNVBAgTEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4GA1UE
# BxMHU2FsZm9yZDEaMBgGA1UEChMRQ09NT0RPIENBIExpbWl0ZWQxKjAoBgNVBAMT
# IUNPTU9ETyBTSEEtMSBUaW1lIFN0YW1waW5nIFNpZ25lcjCCASIwDQYJKoZIhvcN
# AQEBBQADggEPADCCAQoCggEBAOnpPd/XNwjJHjiyUlNCbSLxscQGBGue/YJ0UEN9
# xqC7H075AnEmse9D2IOMSPznD5d6muuc3qajDjscRBh1jnilF2n+SRik4rtcTv6O
# KlR6UPDV9syR55l51955lNeWM/4Og74iv2MWLKPdKBuvPavql9LxvwQQ5z1IRf0f
# aGXBf1mZacAiMQxibqdcZQEhsGPEIhgn7ub80gA9Ry6ouIZWXQTcExclbhzfRA8V
# zbfbpVd2Qm8AaIKZ0uPB3vCLlFdM7AiQIiHOIiuYDELmQpOUmJPv/QbZP7xbm1Q8
# ILHuatZHesWrgOkwmt7xpD9VTQoJNIp1KdJprZcPUL/4ygkCAwEAAaOB9DCB8TAf
# BgNVHSMEGDAWgBTa7WR0FJwUPKvdmam9WyhNizzJ2DAdBgNVHQ4EFgQUjmstM2v0
# M6eTsxOapeAK9xI1aogwDgYDVR0PAQH/BAQDAgbAMAwGA1UdEwEB/wQCMAAwFgYD
# VR0lAQH/BAwwCgYIKwYBBQUHAwgwQgYDVR0fBDswOTA3oDWgM4YxaHR0cDovL2Ny
# bC51c2VydHJ1c3QuY29tL1VUTi1VU0VSRmlyc3QtT2JqZWN0LmNybDA1BggrBgEF
# BQcBAQQpMCcwJQYIKwYBBQUHMAGGGWh0dHA6Ly9vY3NwLnVzZXJ0cnVzdC5jb20w
# DQYJKoZIhvcNAQEFBQADggEBALozJEBAjHzbWJ+zYJiy9cAx/usfblD2CuDk5oGt
# Joei3/2z2vRz8wD7KRuJGxU+22tSkyvErDmB1zxnV5o5NuAoCJrjOU+biQl/e8Vh
# f1mJMiUKaq4aPvCiJ6i2w7iH9xYESEE9XNjsn00gMQTZZaHtzWkHUxY93TYCCojr
# QOUGMAu4Fkvc77xVCf/GPhIudrPczkLv+XZX4bcKBUCYWJpdcRaTcYxlgepv84n3
# +3OttOe/2Y5vqgtPJfO44dXddZhogfiqwNGAwsTEOYnB9smebNd0+dmX+E/CmgrN
# Xo/4GengpZ/E8JIh5i15Jcki+cPwOoRXrToW9GOUEB1d0MYwggUhMIIECaADAgEC
# AhAJxoSGnwrl4EyEKfBqdhdPMA0GCSqGSIb3DQEBCwUAMHIxCzAJBgNVBAYTAlVT
# MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5j
# b20xMTAvBgNVBAMTKERpZ2lDZXJ0IFNIQTIgQXNzdXJlZCBJRCBDb2RlIFNpZ25p
# bmcgQ0EwHhcNMTgwMTEyMDAwMDAwWhcNMTkwMTE3MTIwMDAwWjBeMQswCQYDVQQG
# EwJERTEVMBMGA1UEBxMMU2FhcmJydWVja2VuMRswGQYDVQQKExJUaG9tYXMgSmFu
# ZXRzY2hlY2sxGzAZBgNVBAMTElRob21hcyBKYW5ldHNjaGVjazCCASIwDQYJKoZI
# hvcNAQEBBQADggEPADCCAQoCggEBAKnQsP8DINqaQbvBtlm8oXRLYzxFoMZHlqty
# dfdQ4oOFYxx6J0pvGDJTrENc0aUqoMvT+LrnBDSsTip3fo8Ca4f4WyyAklNpiCVK
# hTO+9vFaoNhs4mhmh2OS1y9M8YXgBlF4kLBYcPJeUHs8243R6SLN648XtE4MzzaI
# PdKA7xL+r034IcizpxhS34SKZh/3OJFtKog9wwfOWyySlzsX0ItvyUQVdXUNMXzl
# IklvrwtmEGpWLfpgDnbH2kSSbpPZKVXYw4qk0nQW+HiM9Jn+jA2sFziSFWobLXX2
# QQ9kyAkjJNWdYZK7cfQLI8V5pBfpSMOxqUx9ihfi77pfvwyvBV8CAwEAAaOCAcUw
# ggHBMB8GA1UdIwQYMBaAFFrEuXsqCqOl6nEDwGD5LfZldQ5YMB0GA1UdDgQWBBQo
# +/yKDq3ZwyaVVtnOejjsrTUKOTAOBgNVHQ8BAf8EBAMCB4AwEwYDVR0lBAwwCgYI
# KwYBBQUHAwMwdwYDVR0fBHAwbjA1oDOgMYYvaHR0cDovL2NybDMuZGlnaWNlcnQu
# Y29tL3NoYTItYXNzdXJlZC1jcy1nMS5jcmwwNaAzoDGGL2h0dHA6Ly9jcmw0LmRp
# Z2ljZXJ0LmNvbS9zaGEyLWFzc3VyZWQtY3MtZzEuY3JsMEwGA1UdIARFMEMwNwYJ
# YIZIAYb9bAMBMCowKAYIKwYBBQUHAgEWHGh0dHBzOi8vd3d3LmRpZ2ljZXJ0LmNv
# bS9DUFMwCAYGZ4EMAQQBMIGEBggrBgEFBQcBAQR4MHYwJAYIKwYBBQUHMAGGGGh0
# dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBOBggrBgEFBQcwAoZCaHR0cDovL2NhY2Vy
# dHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0U0hBMkFzc3VyZWRJRENvZGVTaWduaW5n
# Q0EuY3J0MAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcNAQELBQADggEBADAOXoiZPLn9
# djcAfJJsP9dY1b2h06Mp/zilB3s8+Gpro2s/RtXw6wGQMarpgehVSLG2TgbcjHWx
# ZsRLgQmAi73s/sQKslUfnN40L0lmIVCuACz4y18lgOxiraavpNVLAeKes4CNjxcc
# dvAE3by0DLzk7hvRIcjbSqG121yO+N27TRGZwdM1z9QiVIgt0tKrs+H9rnSKSt27
# 5/dpnFwbwzZZS3tazmxZXh+dQsavvjgkl04ZZfngBqGXXs9KL6XNdXGIZgTirewI
# bJkODA0ICysaj2a7FM13z4VbSTVemXdhnm2sCulNkE4cYYx3I2l4cPcju3IqGV60
# XmIbwKpzFakwggUwMIIEGKADAgECAhAECRgbX9W7ZnVTQ7VvlVAIMA0GCSqGSIb3
# DQEBCwUAMGUxCzAJBgNVBAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAX
# BgNVBAsTEHd3dy5kaWdpY2VydC5jb20xJDAiBgNVBAMTG0RpZ2lDZXJ0IEFzc3Vy
# ZWQgSUQgUm9vdCBDQTAeFw0xMzEwMjIxMjAwMDBaFw0yODEwMjIxMjAwMDBaMHIx
# CzAJBgNVBAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3
# dy5kaWdpY2VydC5jb20xMTAvBgNVBAMTKERpZ2lDZXJ0IFNIQTIgQXNzdXJlZCBJ
# RCBDb2RlIFNpZ25pbmcgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
# AQD407Mcfw4Rr2d3B9MLMUkZz9D7RZmxOttE9X/lqJ3bMtdx6nadBS63j/qSQ8Cl
# +YnUNxnXtqrwnIal2CWsDnkoOn7p0WfTxvspJ8fTeyOU5JEjlpB3gvmhhCNmElQz
# UHSxKCa7JGnCwlLyFGeKiUXULaGj6YgsIJWuHEqHCN8M9eJNYBi+qsSyrnAxZjNx
# PqxwoqvOf+l8y5Kh5TsxHM/q8grkV7tKtel05iv+bMt+dDk2DZDv5LVOpKnqagqr
# hPOsZ061xPeM0SAlI+sIZD5SlsHyDxL0xY4PwaLoLFH3c7y9hbFig3NBggfkOItq
# cyDQD2RzPJ6fpjOp/RnfJZPRAgMBAAGjggHNMIIByTASBgNVHRMBAf8ECDAGAQH/
# AgEAMA4GA1UdDwEB/wQEAwIBhjATBgNVHSUEDDAKBggrBgEFBQcDAzB5BggrBgEF
# BQcBAQRtMGswJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBD
# BggrBgEFBQcwAoY3aHR0cDovL2NhY2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0
# QXNzdXJlZElEUm9vdENBLmNydDCBgQYDVR0fBHoweDA6oDigNoY0aHR0cDovL2Ny
# bDQuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0QXNzdXJlZElEUm9vdENBLmNybDA6oDig
# NoY0aHR0cDovL2NybDMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0QXNzdXJlZElEUm9v
# dENBLmNybDBPBgNVHSAESDBGMDgGCmCGSAGG/WwAAgQwKjAoBggrBgEFBQcCARYc
# aHR0cHM6Ly93d3cuZGlnaWNlcnQuY29tL0NQUzAKBghghkgBhv1sAzAdBgNVHQ4E
# FgQUWsS5eyoKo6XqcQPAYPkt9mV1DlgwHwYDVR0jBBgwFoAUReuir/SSy4IxLVGL
# p6chnfNtyA8wDQYJKoZIhvcNAQELBQADggEBAD7sDVoks/Mi0RXILHwlKXaoHV0c
# LToaxO8wYdd+C2D9wz0PxK+L/e8q3yBVN7Dh9tGSdQ9RtG6ljlriXiSBThCk7j9x
# jmMOE0ut119EefM2FAaK95xGTlz/kLEbBw6RFfu6r7VRwo0kriTGxycqoSkoGjpx
# KAI8LpGjwCUR4pwUR6F6aGivm6dcIFzZcbEMj7uo+MUSaJ/PQMtARKUT8OZkDCUI
# QjKyNookAv4vcn4c10lFluhZHen6dGRrsutmQ9qzsIzV6Q3d9gEgzpkxYz0IGhiz
# gZtPxpMQBvwHgfqL2vmCSfdibqFT+hKUGIUukpHqaGxEMrJmoecYpJpkUe8xggRv
# MIIEawIBATCBhjByMQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5j
# MRkwFwYDVQQLExB3d3cuZGlnaWNlcnQuY29tMTEwLwYDVQQDEyhEaWdpQ2VydCBT
# SEEyIEFzc3VyZWQgSUQgQ29kZSBTaWduaW5nIENBAhAJxoSGnwrl4EyEKfBqdhdP
# MAkGBSsOAwIaBQCgeDAYBgorBgEEAYI3AgEMMQowCKACgAChAoAAMBkGCSqGSIb3
# DQEJAzEMBgorBgEEAYI3AgEEMBwGCisGAQQBgjcCAQsxDjAMBgorBgEEAYI3AgEV
# MCMGCSqGSIb3DQEJBDEWBBR5WbHVug4HIKZWL2xcyWOoLFUUxDANBgkqhkiG9w0B
# AQEFAASCAQCeNx2EjBNmnU59uclkcm4O5NkyRh/6dokJaQQj3PWZjRhXgqLiA7d7
# ZIqFtg6IjNvVtg7mZ6eK+6CM7O//5XAI2XTd/6k+TCJ1Rpd43AQntqVc1fZV7Cl4
# 4fJaHoN7FIV+nESduDNjmpU33bLRGBsJzjQvTXbSx9CQmpamWZugjqF+dgqS0dWb
# fknGNeV696xrefIAvbCLeGKIrYQkJ/6u8FMJsSbw3v/2U5amZttOIYsULqbK4ilV
# RH4ia0Z9oNNqoH2bcmadanTYSN2RV9bgCakxHQIBOB1zv5kTCU4zJxTYXPsuhilt
# qrqApfKbi4d1kmfnMNr81TW6Csjf02QPoYICQzCCAj8GCSqGSIb3DQEJBjGCAjAw
# ggIsAgEBMIGpMIGVMQswCQYDVQQGEwJVUzELMAkGA1UECBMCVVQxFzAVBgNVBAcT
# DlNhbHQgTGFrZSBDaXR5MR4wHAYDVQQKExVUaGUgVVNFUlRSVVNUIE5ldHdvcmsx
# ITAfBgNVBAsTGGh0dHA6Ly93d3cudXNlcnRydXN0LmNvbTEdMBsGA1UEAxMUVVRO
# LVVTRVJGaXJzdC1PYmplY3QCDxaI8DklXmOOaRQ5B+YzCzAJBgUrDgMCGgUAoF0w
# GAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMTgwMTEy
# MTkxOTQ5WjAjBgkqhkiG9w0BCQQxFgQU8WiGmdVfkLCEkJgpV4SIE65hzg0wDQYJ
# KoZIhvcNAQEBBQAEggEAFZ//t+aC1xB2M/ibKm9Sj07mVpghzGee6p/2kc3KbEoj
# gXFSW5LvXrq75ITJ+QBitofCaEhhMnp17WBcZwPPrBESPZdMraUGxPP3XzZ7j4hd
# LmjO7JJ/HL6NZ2YWbQidqsJiEzq405a6hgkmPsDqaz+5ab4upC+EWWrj4sm2kNN3
# dRWubi9rWt7aeMzAzdKcbCaFRmMgRvI+woLj8SkoJOGccsslWefOe6nN98h85NGJ
# a1TbZQj8ABhlpAYaeR5KUXLLMgDzmrreFnlNDYQLgxUEzzAlt9iRh5JXoaYS0k7P
# zJ4juaG8UDP/mXMo1GDvXFJja+cvOgC+hvRw4xWaKg==
# SIG # End signature block